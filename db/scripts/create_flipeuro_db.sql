SET SCHEMA PUBLIC;

CREATE TEXT TABLE PUBLIC.USER(USER_ID BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY,FIRSTNAME VARCHAR(50),LASTNAME VARCHAR(50),USERNAME VARCHAR(50), PASSWORD VARCHAR(50), DATE_OF_BIRTH DATE, ADDRESS VARCHAR(128), BALANCE DOUBLE);
CREATE TEXT TABLE PUBLIC.COIN(COIN_ID BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY, NAME VARCHAR(50), DENOMINATION DOUBLE, CURRENCY VARCHAR(3));
CREATE TEXT TABLE PUBLIC.CREDIT_CARD(CREDIT_CARD_ID BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY, USER_ID BIGINT, CARD_NUMBER VARCHAR(20), CARD_HOLDERS_NAME VARCHAR(100), EXPIRY_MONTH TINYINT, EXPIRY_YEAR TINYINT, FOREIGN KEY (USER_ID) REFERENCES USER(USER_ID));
CREATE TEXT TABLE PUBLIC.DEPOSIT(DEPOSIT_ID BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY, USER_ID BIGINT, CREDIT_CARD_ID BIGINT, DEPOSIT_DATE DATE, DEPOSIT_AMOUNT DOUBLE, FOREIGN KEY (USER_ID) REFERENCES USER(USER_ID), FOREIGN KEY (CREDIT_CARD_ID) REFERENCES CREDIT_CARD(CREDIT_CARD_ID));
CREATE TEXT TABLE PUBLIC.COIN_FLIP(COIN_FLIP_ID BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY, USER_ID BIGINT, COIN_ID BIGINT, COIN_FLIP_DATE DATE, BET VARCHAR(5), OUTCOME VARCHAR(5), FOREIGN KEY (USER_ID) REFERENCES USER(USER_ID), FOREIGN KEY (COIN_ID) REFERENCES COIN(COIN_ID));
CREATE TEXT TABLE PUBLIC.ROLE(ROLE_ID BIGINT GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL PRIMARY KEY, ROLE_NAME VARCHAR(10));

ALTER TABLE PUBLIC.USER ADD ROLE_ID BIGINT NOT NULL;
ALTER TABLE PUBLIC.USER ADD FOREIGN KEY(ROLE_ID) REFERENCES PUBLIC.ROLE(ROLE_ID);
ALTER TABLE PUBLIC.CREDIT_CARD ALTER COLUMN USER_ID SET NOT NULL;
ALTER TABLE PUBLIC.DEPOSIT ALTER COLUMN USER_ID SET NOT NULL;
ALTER TABLE PUBLIC.DEPOSIT ALTER COLUMN CREDIT_CARD_ID SET NOT NULL;
ALTER TABLE PUBLIC.COIN_FLIP ALTER COLUMN USER_ID SET NOT NULL;
ALTER TABLE PUBLIC.COIN_FLIP ALTER COLUMN COIN_ID SET NOT NULL;